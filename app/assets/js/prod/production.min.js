"use strict";angular.module("myApp",["ngRoute","ui.bootstrap","myApp.menu","myApp.services","myApp.modal"]).config(function($routeProvider){$routeProvider.when("/cat/:catname/card/:cardname",{templateUrl:"modalContainer",controller:"ModalCtrl"}).when("/cat/:catname",{templateUrl:"modalContainer",controller:"ModalCtrl"}).when("/menu",{controller:"MenuCtrl"}).otherwise({redirectTo:"/menu"})}),angular.module("myApp.menu",["ngRoute"]).controller("MenuCtrl",["$scope","DataService",function($scope,DataService){function loadData(){DataService.getJSON().then(function(articles){$scope.categories=$.map(articles,function(el){return el})})}$scope.categories=loadData()}]),angular.module("myApp.modal",["ngRoute"]).controller("ModalCtrl",["$scope","$modal","$route","$location","DataService",function($scope,$modal,$route,$location){var modalInstance,modalDetailInstance,detail;detail=$route.current.pathParams.cardname,modalInstance||(modalInstance=$modal.open({templateUrl:"../assets/templates/modal-category.html",controller:"ModalCategoryCtrl"})),detail&&!modalDetailInstance&&(modalDetailInstance=$modal.open({templateUrl:"../assets/templates/modal-detail.html",controller:"ModalDetailCtrl"})),$scope.$on("$locationChangeStart",function(){modalInstance.close(),modalDetailInstance&&modalDetailInstance.close()}),$scope.close=function(){$modalInstance.dismiss(),$location.path("/menu")}}]).controller("ModalCategoryCtrl",["$scope","$route","$location","$sce","$timeout","$modalInstance","DataService",function($scope,$route,$location,$sce,$timeout,$modalInstance,DataService){var name=$route.current.pathParams.catname;$scope.category=DataService.getCategory(name),$scope.close=function(){$modalInstance.dismiss(),$location.path("/menu")},$scope.next=DataService.getCatNext(name,DataService.categories),$scope.prev=DataService.getCatPrev(name),$scope.TrustDangerousSnippet=function(post){return $sce.trustAsHtml(post)}}]).controller("ModalDetailCtrl",["$scope","$route","$location","$sce","$timeout","$modalInstance","DataService",function($scope,$route,$location,$sce,$timeout,$modalInstance,DataService){function findActivity(name){for(var i=0;i<$scope.category.activities.length;i++)name==$scope.category.activities[i].shortName&&($scope.activity=$scope.category.activities[i])}var name=$route.current.pathParams.cardname;$scope.category=DataService.getCategory($route.current.pathParams.catname),$scope.closeDetail=function(){$modalInstance.dismiss(),$location.path("/cat/"+$route.current.pathParams.catname)},$scope.next=DataService.getCardNext(name,$scope.category.activities),$scope.prev=DataService.getCardPrev(name,$scope.category.activities),$scope.TrustDangerousSnippet=function(post){return $sce.trustAsHtml(post)},findActivity(name)}]),angular.module("myApp.services",[]).service("DataService",["$http","$q",function($http,$q){function setCategory(name,category){categories[name]=category}function getCategory(name){for(var category,i=0;i<categories.length;i++)categories[i].shortName==name&&(category=categories[i]);return category}function getCardNext(name,arr){var next,self=findIndex(name,arr);return next=arr[self+1],next||(next=arr[0]),next.shortName}function getCardPrev(name,arr){var prev,self=findIndex(name,arr);return prev=arr[self-1],prev||(prev=arr[arr.length-1]),prev.shortName}function getCatNext(name){var next,self=findIndex(name,categories);return next=categories[self+1],next||(next=categories[0]),next.shortName}function getCatPrev(name){var prev,self=findIndex(name,categories);return prev=categories[self-1],prev||(prev=categories[categories.length-1]),prev.shortName}function findIndex(name,arr){for(var index,i=0;i<arr.length;i++)arr[i].shortName==name&&(index=i);return index}function getJSON(){var request=$http({method:"get",dataType:"jsonp",url:"../assets/json/categories.json",params:{action:"get"}});return request.then(handleSuccess,handleError)}function handleError(response){return $q.reject(angular.isObject(response.data)&&response.data.message?response.data.message:"An unknown error occurred.")}function handleSuccess(response){return cards=response.data,categories=response.data}var cards,categories={};return{getJSON:getJSON,getCatNext:getCatNext,getCatPrev:getCatPrev,getCardNext:getCardNext,getCardPrev:getCardPrev,setCategory:setCategory,getCategory:getCategory,categories:categories}}]);